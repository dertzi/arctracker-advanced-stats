// ==UserScript==
// @name         ArcTracker Advanced Stats
// @namespace    violentmonkey
// @version      1.0.17
// @description  Full raid history stats, maps, charts, filter-sync, pagination, gains/losses for ArcTracker.
// @match        https://arctracker.io/raid-history*
// @grant        none
// ==/UserScript==

!function(){"use strict";let t=null,e=null;function n(t){return t.toLocaleString()}function a(t){return new Promise(e=>setTimeout(e,t))}const r="arcstats_raid_cache";function i(){localStorage.removeItem(r),console.log("[ArcStats] Cache cleared")}function o(t,e){const n=new URL(t,location.origin);return n.searchParams.set("offset",String(e)),n.toString()}async function s(t){try{const e=await fetch(t,{headers:{"X-ArcStats":"1"}});if(!e.ok)throw new Error("Bad API response");return await e.json()}catch(t){return console.error("[ArcStats] Error fetching page:",t),{raids:[],pagination:{hasMore:!1}}}}async function c(t,e=!1){if(!e){const e=function(t){try{const e=localStorage.getItem(r);if(!e)return null;const{timestamp:n,filters:a,data:i}=JSON.parse(e),o=Date.now()-new Date(n).getTime();return o<36e5&&a===t?(console.log(`[ArcStats] Using cached data (${Math.round(o/6e4)}m old)`),i):(console.log("[ArcStats] Cache expired or filters changed"),null)}catch(t){return console.error("[ArcStats] Cache read error:",t),null}}(t);if(e)return e}console.log("[ArcStats] Fetching full raid history with filters:",t);let n=[],c=0;for(;;){const e=o(t,c),r=await s(e);if(!r.raids||0===r.raids.length)break;if(n=n.concat(r.raids),!r.pagination?.hasMore)break;c+=20,await a(120)}return console.log(`[ArcStats] Loaded ${n.length} total raids.`),function(t,e){const n={timestamp:(new Date).toISOString(),filters:t,raids:e};try{localStorage.setItem(r,JSON.stringify(n)),console.log(`[ArcStats] Cached ${e.length} raids`)}catch(t){if(console.error("[ArcStats] Cache write error:",t),t instanceof Error&&"QuotaExceededError"===t.name){i();try{localStorage.setItem(r,JSON.stringify(n))}catch(t){console.error("[ArcStats] Cache write failed even after clearing")}}}}(t,n),n}const l={"dam-battleground":"Dam Battleground","the-spaceport":"Spaceport","buried-city":"Buried City","blue-gate":"The Blue Gate","stella-montis":"Stella Montis"};function d(t){if(!t||0===t.length)return{totalProfit:0,totalRaids:0,totalSurvived:0,totalKIA:0,avgPerRaid:0,avgPerSurvive:0,profitPerDay:0,days:1,cumulative:[],mapStatsArray:[],biggestGains:[],biggestLosses:[]};let e=0,n=0,a=0,r=null,i=null;const o={};for(const t in l)o[t]={name:l[t],raids:0,survived:0,profit:0};const s=[];t.forEach(t=>{const c=t.effectiveValue??t.totalValueOverride??t.totalValue??0,d=(u=t.raidDate,new Date(u));var u;s.push(c),e+=c,"survived"===t.status?n++:a++,d&&((!r||d<r)&&(r=d),(!i||d>i)&&(i=d)),l[t.mapId]&&(o[t.mapId]||(o[t.mapId]={name:l[t.mapId],raids:0,survived:0,profit:0}),o[t.mapId].raids++,o[t.mapId].profit+=c,"survived"===t.status&&o[t.mapId].survived++)});const c=[];let d=0;s.forEach(t=>{d+=t,c.push(d)});let u=1;if(r&&i){const t=(i-r)/864e5;u=Math.max(1,t)}const m=t.length,g=s.filter(t=>t>0).sort((t,e)=>e-t).slice(0,5),f=s.filter(t=>t<0).sort((t,e)=>t-e).slice(0,5),v=Object.entries(o).map(([t,e])=>{const n=e.raids>0?e.survived/e.raids:0;return{id:t,name:e.name,profit:e.profit,raids:e.raids,survived:e.survived,survivalRate:n}});return{totalProfit:e,totalRaids:m,totalSurvived:n,totalKIA:a,avgPerRaid:m?e/m:0,avgPerSurvive:n?e/n:0,profitPerDay:e/u,days:u,cumulative:c,mapStatsArray:v,biggestGains:g,biggestLosses:f}}function u(t){return"number"==typeof t.totalValueOverride?t.totalValueOverride:"number"==typeof t.effectiveValue?t.effectiveValue:"N/A"}function m(t,e,n){const{min:a,range:r}=e;return n-(t-a)/r*n}function g(t,e,n){return e<=1?0:t/(e-1)*n}function f(t,e,a,r){const i=t._chartData,o=t._chartRanges;i&&o&&(t.onmousemove=o=>{const s=t.getBoundingClientRect(),c=o.clientX-s.left,l=o.clientY-s.top,d=t.width,u=t.height,m=function(t,e,n){const a=e.length;if(a<=1)return 0;const r=Math.round(t/n*(a-1));return Math.max(0,Math.min(a-1,r))}(c,i,d),g=i[m],f=m+1,v=g.cumulative;let p=g.gain;p="N/A"===p?"N/A":n(p),e.innerHTML=`Raid #${f}<br>Cumulative: ${n(v)}<br>Gain/Loss: ${p}`;let h=c+10,x=l+10;h+e.offsetWidth>d&&(h=c-e.offsetWidth-10),x+e.offsetHeight>u&&(x=l-e.offsetHeight-10),e.style.left=h+"px",e.style.top=x+"px",e.style.display="block";const b=t.getContext("2d");r(a),b.strokeStyle="rgba(255,255,255,0.25)",b.setLineDash([4,4]),b.beginPath(),b.moveTo(c,0),b.lineTo(c,u),b.stroke(),b.setLineDash([])},t.onmouseleave=()=>{e.style.display="none",r(a)})}function v(t){const e=t._rawRaidList;if(!e||0===e.length)return;const a=document.getElementById("arcChart"),r=document.getElementById("arcTooltip");if(!a)return;const i=a.getContext("2d");if(!i)return;const o=a.clientWidth,s=a.clientHeight;a.width=o,a.height=s;const c=function(t){const e=[];let n=0;const a=t.slice().reverse();for(let t=0;t<a.length;t++){const r=u(a[t]);"number"==typeof r&&(n+=r),e.push({cumulative:n,gain:r,index:t})}return e}(e),l=function(t){let e=1/0,n=-1/0;for(const a of t)a.cumulative<e&&(e=a.cumulative),a.cumulative>n&&(n=a.cumulative);return e===n&&(e-=1,n+=1),{min:e,max:n,range:n-e}}(c);a._chartData=c,a._chartRanges=l,a._stats=t,function(t,e,a,r,i,o){t.clearRect(0,0,i,o),t.font="10px sans-serif",t.fillStyle="#888";const{min:s,max:c}=r;if(x()){t.strokeStyle="rgba(255,255,255,0.10)",t.lineWidth=1;for(let e=0;e<=4;e++){const n=o/4*e;t.beginPath(),t.moveTo(0,n),t.lineTo(i,n),t.stroke()}}if(s<0&&c>0){const e=m(0,r,o);t.strokeStyle="#aaa",t.lineWidth=1.5,t.beginPath(),t.moveTo(0,e),t.lineTo(i,e),t.stroke(),t.fillText("0",4,e-2)}t.fillText(n(c),4,10),t.fillText(n(s),4,o-4)}(i,0,0,l,o,s),function(t,e,n,a,r,i){t.lineWidth=2,t.beginPath();for(let e=0;e<n.length;e++){const o=g(e,n.length,r),s=m(n[e].cumulative,a,i);0===e?t.moveTo(o,s):t.lineTo(o,s)}const o=a.min>=0,s=a.max<=0;let c;c=o?"rgba(74, 222, 128, 0.25)":s?"rgba(248, 113, 113, 0.25)":"rgba(255, 255, 255, 0.15)",t.lineTo(r,i),t.lineTo(0,i),t.closePath(),t.fillStyle=c,t.fill();for(let e=0;e<n.length-1;e++){const o=g(e,n.length,r),s=m(n[e].cumulative,a,i),c=g(e+1,n.length,r),l=m(n[e+1].cumulative,a,i),d=n[e].cumulative>=0;t.strokeStyle=d?"#4ade80":"#f87171",t.beginPath(),t.moveTo(o,s),t.lineTo(c,l),t.stroke()}}(i,0,c,l,o,s),function(t,e,n,a,r,i){const o=n.map((t,e)=>({gain:t.gain,index:e,cumulative:t.cumulative})).filter(t=>"number"==typeof t.gain);if(0===o.length)return;const s=o.reduce((t,e)=>e.gain>t.gain?e:t,o[0]),c=o.reduce((t,e)=>e.gain<t.gain?e:t,o[0]);function l(e,o){const s=g(e.index,n.length,r),c=m(e.cumulative,a,i);t.beginPath(),t.fillStyle=o,t.strokeStyle=o,t.lineWidth=1.5,t.arc(s,c,4,0,2*Math.PI),t.fill(),t.stroke()}s.gain>0&&l(s,"#4ade80"),c.gain<0&&l(c,"#f87171")}(i,0,c,l,o,s),f(a,r,t,v)}let p=null,h=!0;function x(){return h}function b(t){const e=document.querySelectorAll("div[data-slot='card-content']")[0]||null;if(!e)return;p||(p=document.createElement("div"),p.id="arcStatsBlock",p.className="space-y-3 mb-4",e.insertBefore(p,e.children[1]));const a=t.biggestGains.map(t=>`<div class="text-sm text-green-500">+${n(t)}</div>`).join(""),r=t.biggestLosses.map(t=>`<div class="text-sm text-red-500">${n(t)}</div>`).join("");p.innerHTML=`\n            \x3c!-- ROW 1: Combined Stats (75%) + Raid Summary (25%) --\x3e\n            <div class="arc-row-4cols">\n                \x3c!-- COMBINED STATS CARD (75% width = 3/4 columns) --\x3e\n                <div class="arc-span-3 rounded-lg border bg-card p-3">\n                    <div class="flex flex-col md:flex-row gap-4">\n                        \x3c!-- Total Profit Section --\x3e\n                        <div class="flex-1">\n                            <div class="text-xs text-muted-foreground mb-1">Total Profit</div>\n                            <div class="text-xl font-bold ${t.totalProfit>=0?"text-green-500":"text-red-500"}">\n                                ${n(t.totalProfit)}\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Averages Section --\x3e\n                        <div class="flex-1">\n                            <div class="text-xs text-muted-foreground mb-1">Averages</div>\n                            <div class="text-sm">Per Raid: <b>${n(t.avgPerRaid)}</b></div>\n                            <div class="text-sm">Per Survive: <b>${n(t.avgPerSurvive)}</b></div>\n                            <div class="text-sm">Per Day: <b>${n(t.profitPerDay)}</b></div>\n                        </div>\n                        \n                        \x3c!-- Top Gains & Losses Section --\x3e\n                        <div class="flex-1">\n                            <div class="flex flex-row gap-4">\n                                <div class="flex-1">\n                                    <div class="text-xs text-muted-foreground mb-1">Top 5 Gains</div>\n                                    ${a}\n                                </div>\n                                <div class="flex-1">\n                                    <div class="text-xs text-muted-foreground mb-1">Top 5 Losses</div>\n                                    ${r}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \n                \x3c!-- RAID SUMMARY CARD (25% width = 1/4 columns) --\x3e\n                <div class="arc-span-1 rounded-lg border bg-card p-3">\n                    <div class="text-xs text-muted-foreground mb-1">Raid Summary</div>\n                    <div class="text-sm">Total: <b>${t.totalRaids}</b></div>\n                    <div class="text-sm text-green-500">Survived: <b>${t.totalSurvived}</b></div>\n                    <div class="text-sm text-red-500">KIA: <b>${t.totalKIA}</b></div>\n                    \n                    \x3c!-- Dev Tools Section --\x3e\n                    <div class="mt-3 pt-3 border-t border-muted/20">\n                        <div class="text-xs text-muted-foreground mb-2">Dev Tools</div>\n                        <div class="flex gap-1">\n                            <button id="arcExportBtn" class="text-[10px] px-2 py-1 border rounded hover:bg-accent flex-1" title="Export data for development">\n                                ðŸ’¾ Export\n                            </button>\n                            <button id="arcRefreshBtn" class="text-[10px] px-2 py-1 border rounded hover:bg-accent flex-1" title="Clear cache & refresh">\n                                ðŸ”„ Refresh\n                            </button>\n                        </div>\n                        <div id="arcCacheStatus" class="text-[10px] text-muted-foreground mt-1"></div>\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- ROW 2: PROFIT CHART (Full width) --\x3e\n            <div class="rounded-lg border bg-card p-3">\n                <div class="flex justify-between items-center mb-2">\n                    <div class="text-xs text-muted-foreground">Profit Chart</div>\n                    <button id="arcGridToggle" class="text-[10px] px-2 py-1 border rounded hover:bg-accent">\n                        Grids: ON\n                    </button>\n                </div>\n                <div style="position:relative;">\n                    <canvas id="arcChart" style="width:100%; height:200px;"></canvas>\n                    <div id="arcTooltip"\n                        style="\n                            position:absolute;\n                            padding:4px 6px;\n                            background:#0009;\n                            color:white;\n                            font-size:11px;\n                            pointer-events:none;\n                            border-radius:4px;\n                            display:none;\n                        ">\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- ROW 3: Histogram (50%) + Map Stats (50%) --\x3e\n            <div class="arc-row-2cols">\n                \x3c!-- HISTOGRAM (50% width = 1/2 columns) --\x3e\n                <div class="arc-span-1 rounded-lg border bg-card p-3">\n                    <div class="flex justify-between items-center mb-2">\n                        <div class="text-xs text-muted-foreground">Profit Distribution</div>\n                    </div>\n                    <div style="position:relative;">\n                        <canvas id="arcHistogram" style="width:100%; height:180px;"></canvas>\n                        <div id="arcHistTooltip"\n                            style="\n                                position:absolute;\n                                padding:4px 6px;\n                                background:#0009;\n                                color:white;\n                                font-size:11px;\n                                pointer-events:none;\n                                border-radius:4px;\n                                display:none;\n                            ">\n                        </div>\n                    </div>\n                </div>\n                \n                \x3c!-- MAP STATS (50% width = 1/2 columns) --\x3e\n                <div class="arc-span-1 rounded-lg border bg-card p-3">\n                    <div class="text-xs text-muted-foreground mb-3">Map Stats</div>\n                    <div class="text-[11px] font-semibold text-muted-foreground mb-2" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 0.5rem;">\n                        <div>MAP</div>\n                        <div class="text-right">PROFIT</div>\n                        <div class="text-right">SURVIVAL</div>\n                        <div class="text-right">RAIDS</div>\n                        <div class="text-right">SURVIVED</div>\n                    </div>\n                    <div id="arcMapStatsRows" class="space-y-1"></div>\n                </div>\n            </div>\n        `;const o=document.getElementById("arcGridToggle");o&&(o.onclick=()=>{var e;e=!x(),h=e,o.textContent="Grids: "+(x()?"ON":"OFF"),v(t)});const s=document.getElementById("arcExportBtn");s&&(s.onclick=()=>function(t){const e={metadata:{capturedAt:(new Date).toISOString(),totalRaids:t.totalRaids,dateRange:t.days?{earliest:new Date(Date.now()-864e5*t.days).toISOString(),latest:(new Date).toISOString()}:null,note:"Exported raid data for development/testing. Save to test-data/mock-raids.json"},raids:t._rawRaidList||[]},n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download="mock-raids.json",r.click(),URL.revokeObjectURL(a),console.log("[ArcStats] Exported",e.raids.length,"raids")}(t));const c=document.getElementById("arcRefreshBtn");c&&(c.onclick=()=>{i(),y(),window.location.reload()}),y(),v(t),function(t){const e=document.getElementById("arcMapStatsRows");if(!e)return;const a=(r=t.mapStatsArray,r.slice().sort((t,e)=>e.profit!==t.profit?e.profit-t.profit:e.survivalRate!==t.survivalRate?e.survivalRate-t.survivalRate:e.raids-t.raids));var r;e.innerHTML=a.map(t=>{const e=t.profit>=0?"text-green-500":"text-red-500";let a="text-red-500";t.survivalRate>.7?a="text-green-500":t.survivalRate>.5&&(a="text-yellow-400");const r=Math.round(100*t.survivalRate);return`\n            <div class="items-center py-1 border-b border-muted/20" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 0.5rem;">\n\n                \x3c!-- MAP NAME --\x3e\n                <div class="text-sm">${t.name}</div>\n\n                \x3c!-- PROFIT --\x3e\n                <div class="text-sm font-bold text-right ${e}">\n                    ${t.profit>=0?"+":""}${n(t.profit)}\n                </div>\n\n                \x3c!-- SURVIVAL PERCENTAGE --\x3e\n                <div class="text-sm text-right font-semibold ${a}">\n                    ${r}%\n                </div>\n\n                \x3c!-- RAIDS --\x3e\n                <div class="text-sm text-right">${t.raids}</div>\n\n                \x3c!-- SURVIVED --\x3e\n                <div class="text-sm text-right">${t.survived}</div>\n\n            </div>\n        `}).join("")}(t)}function y(){const t=document.getElementById("arcCacheStatus");if(!t)return;const e=function(){try{const t=localStorage.getItem(r);if(!t)return{exists:!1,age:null,raidCount:null};const{timestamp:e,data:n}=JSON.parse(t);return{exists:!0,age:Date.now()-new Date(e).getTime(),raidCount:n?.length||0}}catch(t){return{exists:!1,age:null,raidCount:null}}}();if(e.exists&&null!==e.age){const n=Math.round(e.age/6e4);t.textContent=`âš¡ Cached (${n}m ago)`,t.className="text-[10px] text-green-500 mt-1"}else t.textContent="ðŸ“¡ No cache",t.className="text-[10px] text-muted-foreground mt-1"}function S(t){return"number"==typeof t.totalValueOverride?t.totalValueOverride:"number"==typeof t.effectiveValue?t.effectiveValue:0}function R(t,e){return Math.round(t/e)*e}function w(t){return t<2e4?500:t<8e4?1e3:t<2e5?2500:5e3}function T(t){if(0===t.length)return 0;return t.slice().sort((t,e)=>t-e)[Math.floor(t.length/2)]}function A(t){if(!t||0===t.length)return[];const e=t.map(S),n=e.filter(t=>t<0),a=e.filter(t=>t>0),r=e.length,i=(o=r,Math.max(4,Math.min(15,Math.ceil(Math.log2(o)+1))));var o;let s=Math.max(1,Math.round(n.length/r*(i-1))),c=Math.max(1,Math.round(a.length/r*(i-1)));const l=function(t,e,n,a){const r=t+e+n-a;return r>0?e>t?{binNeg:t,binPos:e-r}:{binNeg:t-r,binPos:e}:r<0?e>t?{binNeg:t,binPos:e+-r}:{binNeg:t+-r,binPos:e}:{binNeg:t,binPos:e}}(s,c,1,i);s=l.binNeg,c=l.binPos;const d=Math.min(...n,0),u=Math.max(...n,0),m=Math.min(...a,0),g=Math.max(...a,0),f=function(t,e,n,a,r,i){const o=[];if(t.length>0){const e=Math.min(...t),a=(Math.max(...t)-e)/n;for(let t=0;t<n;t++)o.push({min:R(e+t*a,r),max:R(e+(t+1)*a,r),values:[],type:"loss"})}if(o.push({min:0,max:0,values:[],type:"zero"}),e.length>0){const t=Math.min(...e),n=(Math.max(...e)-t)/a;for(let e=0;e<a;e++)o.push({min:R(t+e*n,i),max:R(t+(e+1)*n,i),values:[],type:"gain"})}return o}(n,a,s,c,w(Math.abs(d-u)),w(Math.abs(g-m)));return function(t,e){for(const n of t)for(const t of e){if("zero"===t.type&&0===n){t.values.push(n);break}if(n>=t.min&&n<t.max&&"zero"!==t.type){t.values.push(n);break}}}(e,f),function(t){return t.map(t=>({min:t.min,max:t.max,count:t.values.length,median:T(t.values),type:t.type}))}(f)}function k(t){const e=t._rawRaidList;if(!e||0===e.length)return;const a=document.getElementById("arcHistogram");if(!a)return;const r=a.getContext("2d");if(!r)return;const i=a.clientWidth,o=a.clientHeight;a.width=i,a.height=o;const s=A(e);if(!s||0===s.length)return;a._histBuckets=s,a._histBucketsRaw=e;const c=Math.max(...s.map(t=>t.count),1),l=i/s.length,d=Math.max(2,.18*l);r.clearRect(0,0,i,o),r.strokeStyle="rgba(255,255,255,0.2)",r.beginPath(),r.moveTo(0,o-1),r.lineTo(i,o-1),r.stroke(),s.forEach((t,e)=>{const a=e*l+d/2,i=t.count/c*(.75*o),s=o-i;let u;u="loss"===t.type?"rgba(248, 113, 113, 0.55)":"gain"===t.type?"rgba(74, 222, 128, 0.55)":"rgba(148, 163, 184, 0.45)",r.fillStyle=u,r.fillRect(a,s,l-d,i),r.fillStyle="#ccc",r.font="10px sans-serif",(l>55||e%2==0)&&r.fillText(`${n(t.min)} â†’ ${n(t.max)}`,a,o-4)})}function M(t){const e=document.getElementById("arcHistogram");if(!e)return;k(t);!function(t,e){const a=t._histBuckets;if(!a||0===a.length)return;const r=t.width,i=t.height,o=r/a.length;t.onmousemove=s=>{const c=t.getBoundingClientRect(),l=s.clientX-c.left,d=Math.floor(l/o);if(d<0||d>=a.length)return e.style.display="none",void k({_rawRaidList:t._histBucketsRaw});const u=a[d];let m;m="zero"===u.type?"0 â†’ 0":`${n(u.min)} â†’ ${n(u.max)}`;const g="loss"===(f=u.type)?"Loss":"gain"===f?"Gain":"Zero";var f;e.innerHTML=`\n                Range: ${m}<br>\n                Raids: ${u.count}<br>\n                Median: ${n(u.median)}<br>\n                Type: ${g}\n            `;let v=l+12;v+e.offsetWidth>r&&(v=l-e.offsetWidth-12),e.style.left=v+"px",e.style.top="16px",e.style.display="block",k({_rawRaidList:t._histBucketsRaw});const p=t.getContext("2d");p.save(),p.strokeStyle="rgba(255,255,255,0.35)",p.lineWidth=2,p.strokeRect(d*o+1,1,o-2,i-2),p.restore()},t.onmouseleave=()=>{e.style.display="none",k({_rawRaidList:t._histBucketsRaw})}}(e,document.getElementById("arcHistTooltip"))}let I=null;function B(t){null!==I&&clearTimeout(I),I=setTimeout(async()=>{console.log("[ArcStats] Filters changed, refreshing...");const e=await c(t),n=d(e);n._rawRaidList=e,b(n),M(n)},300)}!function(){console.log("[ArcStats] Initializing..."),function(){if(document.getElementById("arcStatsCustomStyles"))return;const t=document.createElement("style");t.id="arcStatsCustomStyles",t.textContent="\n    /* =============================================================================\n       ARC STATS CUSTOM GRID SYSTEM\n       Overrides ArcTracker's forced grid-column rules with !important\n       ============================================================================= */\n\n    /* Base container styling */\n    #arcStatsBlock {\n      width: 100% !important;\n      max-width: 100% !important;\n    }\n\n    /* 4-column grid (for 75%/25% or other layouts) */\n    #arcStatsBlock .arc-row-4cols {\n      display: grid !important;\n      grid-template-columns: repeat(4, 1fr) !important;\n      gap: 0.75rem !important;\n      width: 100% !important;\n    }\n\n    /* 2-column grid (for 50%/50% layouts) */\n    #arcStatsBlock .arc-row-2cols {\n      display: grid !important;\n      grid-template-columns: repeat(2, 1fr) !important;\n      gap: 0.75rem !important;\n      width: 100% !important;\n    }\n\n    /* Single column (full-width) */\n    #arcStatsBlock .arc-row-1col {\n      display: block !important;\n      width: 100% !important;\n    }\n\n    /* Column span classes */\n    #arcStatsBlock .arc-span-4 {\n      grid-column: span 4 / span 4 !important;\n    }\n\n    #arcStatsBlock .arc-span-3 {\n      grid-column: span 3 / span 3 !important;\n    }\n\n    #arcStatsBlock .arc-span-2 {\n      grid-column: span 2 / span 2 !important;\n    }\n\n    #arcStatsBlock .arc-span-1 {\n      grid-column: span 1 / span 1 !important;\n    }\n\n    /* Responsive behavior for tablets */\n    @media (max-width: 768px) {\n      #arcStatsBlock .arc-row-4cols {\n        grid-template-columns: repeat(2, 1fr) !important;\n      }\n\n      #arcStatsBlock .arc-span-3 {\n        grid-column: span 2 / span 2 !important;\n      }\n    }\n\n    /* Responsive behavior for mobile */\n    @media (max-width: 640px) {\n      #arcStatsBlock .arc-row-4cols,\n      #arcStatsBlock .arc-row-2cols {\n        grid-template-columns: 1fr !important;\n      }\n\n      #arcStatsBlock .arc-span-4,\n      #arcStatsBlock .arc-span-3,\n      #arcStatsBlock .arc-span-2,\n      #arcStatsBlock .arc-span-1 {\n        grid-column: span 1 / span 1 !important;\n      }\n    }\n  ",document.head.appendChild(t),console.log("[ArcStats] Custom grid styles injected")}(),function(){const n=globalThis.fetch;globalThis.fetch=async function(a,r){try{"string"!=typeof a||!a.includes("/api/raids?")||r?.headers&&"X-ArcStats"in r.headers||(t=a,console.log("[ArcStats] Detected API:",a),e&&e(a))}catch(t){console.error("[ArcStats] API watch error:",t)}return n(a,r)}}(),e=B;t&&B(t),console.log("[ArcStats] Ready!")}()}();
