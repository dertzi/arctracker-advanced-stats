// ==UserScript==
// @name         ArcTracker Advanced Stats
// @namespace    violentmonkey
// @version      1.0.20
// @description  Full raid history stats, maps, charts, filter-sync, pagination, gains/losses for ArcTracker.
// @match        https://arctracker.io/raid-history*
// @grant        none
// ==/UserScript==

!function(){"use strict";let t=null,e=null;function n(t){return t.toLocaleString()}function a(t){return new Promise(e=>setTimeout(e,t))}const o="arcstats_raid_cache";function r(){localStorage.removeItem(o),console.log("[ArcStats] Cache cleared")}function i(t,e){const n=new URL(t,location.origin);return n.searchParams.set("offset",String(e)),n.toString()}async function s(t){try{const e=await fetch(t,{headers:{"X-ArcStats":"1"}});if(!e.ok)throw new Error("Bad API response");return await e.json()}catch(t){return console.error("[ArcStats] Error fetching page:",t),{raids:[],pagination:{hasMore:!1}}}}async function c(t,e=!1){if(!e){const e=function(t){try{const e=localStorage.getItem(o);if(!e)return null;const{timestamp:n,filters:a,data:r}=JSON.parse(e),i=Date.now()-new Date(n).getTime();return i<36e5&&a===t?(console.log(`[ArcStats] Using cached data (${Math.round(i/6e4)}m old)`),r):(console.log("[ArcStats] Cache expired or filters changed"),null)}catch(t){return console.error("[ArcStats] Cache read error:",t),null}}(t);if(e)return e}console.log("[ArcStats] Fetching full raid history with filters:",t);let n=[],c=0;for(;;){const e=i(t,c),o=await s(e);if(!o.raids||0===o.raids.length)break;if(n=n.concat(o.raids),!o.pagination?.hasMore)break;c+=20,await a(120)}return console.log(`[ArcStats] Loaded ${n.length} total raids.`),function(t,e){const n={timestamp:(new Date).toISOString(),filters:t,raids:e};try{localStorage.setItem(o,JSON.stringify(n)),console.log(`[ArcStats] Cached ${e.length} raids`)}catch(t){if(console.error("[ArcStats] Cache write error:",t),t instanceof Error&&"QuotaExceededError"===t.name){r();try{localStorage.setItem(o,JSON.stringify(n))}catch(t){console.error("[ArcStats] Cache write failed even after clearing:",t)}}}}(t,n),n}const l={"dam-battleground":"Dam Battleground","the-spaceport":"Spaceport","buried-city":"Buried City","blue-gate":"The Blue Gate","stella-montis":"Stella Montis"};function d(t){if(!t||0===t.length)return{totalProfit:0,totalRaids:0,totalSurvived:0,totalKIA:0,avgPerRaid:0,avgPerSurvive:0,profitPerDay:0,days:1,cumulative:[],mapStatsArray:[],biggestGains:[],biggestLosses:[]};let e=0,n=0,a=0,o=null,r=null;const i={};for(const t in l)i[t]={name:l[t],raids:0,survived:0,profit:0};const s=[];t.forEach(t=>{const c=t.effectiveValue??t.totalValueOverride??t.totalValue??0,d=(u=t.raidDate,new Date(u));var u;s.push(c),e+=c,"survived"===t.status?n++:a++,d&&((!o||d<o)&&(o=d),(!r||d>r)&&(r=d)),l[t.mapId]&&(i[t.mapId]||(i[t.mapId]={name:l[t.mapId],raids:0,survived:0,profit:0}),i[t.mapId].raids++,i[t.mapId].profit+=c,"survived"===t.status&&i[t.mapId].survived++)});const c=[];let d=0;s.forEach(t=>{d+=t,c.push(d)});let u=1;if(o&&r){const t=(r-o)/864e5;u=Math.max(1,t)}const m=t.length,p=s.filter(t=>t>0).sort((t,e)=>e-t).slice(0,5),f=s.filter(t=>t<0).sort((t,e)=>t-e).slice(0,5),h=Object.entries(i).map(([t,e])=>{const n=e.raids>0?e.survived/e.raids:0;return{id:t,name:e.name,profit:e.profit,raids:e.raids,survived:e.survived,survivalRate:n}});return{totalProfit:e,totalRaids:m,totalSurvived:n,totalKIA:a,avgPerRaid:m?e/m:0,avgPerSurvive:n?e/n:0,profitPerDay:e/u,days:u,cumulative:c,mapStatsArray:h,biggestGains:p,biggestLosses:f}}function u(t={}){const e=document.createElement("div");return e.className="rounded-lg border bg-card p-3",t.span&&e.classList.add(`arc-span-${t.span}`),e}function m(t){const e=document.createElement("div");return e.className=t,e}function p(t,e){const n=document.createElement("button");return n.className="text-[10px] px-2 py-1 border rounded hover:bg-accent",n.textContent=t,n.onclick=e,n}let f=!0;function h(){return f}function g(t){const e=u({span:3}),a=document.createElement("div");return a.className="flex flex-col md:flex-row gap-4",a.appendChild(function(t){const e=document.createElement("div");e.className="flex-1";const a=document.createElement("div");a.className="text-xs text-muted-foreground mb-1",a.textContent="Total Profit";const o=document.createElement("div");return o.className="text-xl font-bold "+(t>=0?"text-green-500":"text-red-500"),o.textContent=n(t),e.appendChild(a),e.appendChild(o),e}(t.totalProfit)),a.appendChild(function(t){const e=document.createElement("div");e.className="flex-1";const a=document.createElement("div");a.className="text-xs text-muted-foreground mb-1",a.textContent="Averages";const o=v("Per Raid:",n(t.avgPerRaid)),r=v("Per Survive:",n(t.avgPerSurvive)),i=v("Per Day:",n(t.profitPerDay));return e.appendChild(a),e.appendChild(o),e.appendChild(r),e.appendChild(i),e}(t)),a.appendChild(function(t){const e=document.createElement("div");e.className="flex-1";const a=document.createElement("div");a.className="flex flex-row gap-4";const o=document.createElement("div");o.className="flex-1";const r=document.createElement("div");r.className="text-xs text-muted-foreground mb-1",r.textContent="Top 5 Gains",o.appendChild(r),t.biggestGains.forEach(t=>{const e=document.createElement("div");e.className="text-sm text-green-500",e.textContent=`+${n(t)}`,o.appendChild(e)});const i=document.createElement("div");i.className="flex-1";const s=document.createElement("div");return s.className="text-xs text-muted-foreground mb-1",s.textContent="Top 5 Losses",i.appendChild(s),t.biggestLosses.forEach(t=>{const e=document.createElement("div");e.className="text-sm text-red-500",e.textContent=n(t),i.appendChild(e)}),a.appendChild(o),a.appendChild(i),e.appendChild(a),e}(t)),e.appendChild(a),e}function v(t,e){const n=document.createElement("div");return n.className="text-sm",n.innerHTML=`${t} <b>${e}</b>`,n}function x(){r(),globalThis.location.reload()}function y(t){const e=document.createElement("div");e.className="mt-3 pt-3 border-t border-muted/20";const n=document.createElement("div");n.className="text-xs text-muted-foreground mb-2",n.textContent="Dev Tools";const a=document.createElement("div");a.className="flex gap-1";const r=p("ðŸ’¾ Export",()=>function(t){const e={metadata:{capturedAt:(new Date).toISOString(),totalRaids:t.totalRaids,dateRange:t.days?{earliest:new Date(Date.now()-864e5*t.days).toISOString(),latest:(new Date).toISOString()}:null,note:"Exported raid data for development/testing. Save to test-data/mock-raids.json"},raids:t._rawRaidList||[]},n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download="mock-raids.json",o.click(),URL.revokeObjectURL(a),console.log("[ArcStats] Exported",e.raids.length,"raids")}(t));r.className+=" flex-1",r.title="Export data for development";const i=p("ðŸ”„ Refresh",x);i.className+=" flex-1",i.title="Clear cache & refresh",a.appendChild(r),a.appendChild(i);const s=document.createElement("div");return s.className="text-[10px] text-muted-foreground mt-1",function(t){const e=function(){try{const t=localStorage.getItem(o);if(!t)return{exists:!1,age:null,raidCount:null};const{timestamp:e,data:n}=JSON.parse(t);return{exists:!0,age:Date.now()-new Date(e).getTime(),raidCount:n?.length||0}}catch(t){return console.error("[ArcStats] Cache status check error:",t),{exists:!1,age:null,raidCount:null}}}();if(e.exists&&null!==e.age){const n=Math.round(e.age/6e4);t.textContent=`âš¡ Cached (${n}m ago)`,t.className="text-[10px] text-green-500 mt-1"}else t.textContent="ðŸ“¡ No cache",t.className="text-[10px] text-muted-foreground mt-1"}(s),e.appendChild(n),e.appendChild(a),e.appendChild(s),e}function b(t,e,n=""){const a=document.createElement("div");return a.className=`text-sm ${n}`,a.innerHTML=`${t} <b>${e}</b>`,a}function S(t){return"number"==typeof t.totalValueOverride?t.totalValueOverride:"number"==typeof t.effectiveValue?t.effectiveValue:"N/A"}function C(t,e,n){const{min:a,range:o}=e;return n-(t-a)/o*n}function w(t,e,n){return e<=1?0:t/(e-1)*n}function E(t,e,a,o){const r=t._chartData,i=t._chartRanges;r&&i&&(t.onmousemove=i=>{const s=t.getBoundingClientRect(),c=i.clientX-s.left,l=i.clientY-s.top,d=t.width,u=t.height,m=function(t,e,n){const a=e.length;if(a<=1)return 0;const o=Math.round(t/n*(a-1));return Math.max(0,Math.min(a-1,o))}(c,r,d),p=r[m],f=m+1,h=p.cumulative;let g=p.gain;g="N/A"===g?"N/A":n(g),e.innerHTML=`Raid #${f}<br>Cumulative: ${n(h)}<br>Gain/Loss: ${g}`;let v=c+10,x=l+10;v+e.offsetWidth>d&&(v=c-e.offsetWidth-10),x+e.offsetHeight>u&&(x=l-e.offsetHeight-10),e.style.left=v+"px",e.style.top=x+"px",e.style.display="block";const y=t.getContext("2d");o(a),y.strokeStyle="rgba(255,255,255,0.25)",y.setLineDash([4,4]),y.beginPath(),y.moveTo(c,0),y.lineTo(c,u),y.stroke(),y.setLineDash([])},t.onmouseleave=()=>{e.style.display="none",o(a)})}function R(t){const e=t._rawRaidList;if(!e||0===e.length)return;const a=document.getElementById("arcChart"),o=document.getElementById("arcTooltip");if(!a)return;const r=a.getContext("2d");if(!r)return;const i=a.clientWidth,s=a.clientHeight;a.width=i,a.height=s;const c=function(t){const e=[];let n=0;const a=t.slice().reverse();for(let t=0;t<a.length;t++){const o=S(a[t]);"number"==typeof o&&(n+=o),e.push({cumulative:n,gain:o,index:t})}return e}(e),l=function(t){let e=1/0,n=-1/0;for(const a of t)a.cumulative<e&&(e=a.cumulative),a.cumulative>n&&(n=a.cumulative);return e===n&&(e-=1,n+=1),{min:e,max:n,range:n-e}}(c);a._chartData=c,a._chartRanges=l,a._stats=t,function(t,e,a,o,r,i){t.clearRect(0,0,r,i),t.font="10px sans-serif",t.fillStyle="#888";const{min:s,max:c}=o;if(h()){t.strokeStyle="rgba(255,255,255,0.10)",t.lineWidth=1;for(let e=0;e<=4;e++){const n=i/4*e;t.beginPath(),t.moveTo(0,n),t.lineTo(r,n),t.stroke()}}if(s<0&&c>0){const e=C(0,o,i);t.strokeStyle="#aaa",t.lineWidth=1.5,t.beginPath(),t.moveTo(0,e),t.lineTo(r,e),t.stroke(),t.fillText("0",4,e-2)}t.fillText(n(c),4,10),t.fillText(n(s),4,i-4)}(r,0,0,l,i,s),function(t,e,n,a,o,r){t.lineWidth=2,t.beginPath();for(let e=0;e<n.length;e++){const i=w(e,n.length,o),s=C(n[e].cumulative,a,r);0===e?t.moveTo(i,s):t.lineTo(i,s)}const i=a.min>=0,s=a.max<=0;let c;c=i?"rgba(74, 222, 128, 0.25)":s?"rgba(248, 113, 113, 0.25)":"rgba(255, 255, 255, 0.15)",t.lineTo(o,r),t.lineTo(0,r),t.closePath(),t.fillStyle=c,t.fill();for(let e=0;e<n.length-1;e++){const i=w(e,n.length,o),s=C(n[e].cumulative,a,r),c=w(e+1,n.length,o),l=C(n[e+1].cumulative,a,r),d=n[e].cumulative>=0;t.strokeStyle=d?"#4ade80":"#f87171",t.beginPath(),t.moveTo(i,s),t.lineTo(c,l),t.stroke()}}(r,0,c,l,i,s),function(t,e,n,a,o,r){const i=n.map((t,e)=>({gain:t.gain,index:e,cumulative:t.cumulative})).filter(t=>"number"==typeof t.gain);if(0===i.length)return;const s=i.reduce((t,e)=>e.gain>t.gain?e:t,i[0]),c=i.reduce((t,e)=>e.gain<t.gain?e:t,i[0]);function l(e,i){const s=w(e.index,n.length,o),c=C(e.cumulative,a,r);t.beginPath(),t.fillStyle=i,t.strokeStyle=i,t.lineWidth=1.5,t.arc(s,c,4,0,2*Math.PI),t.fill(),t.stroke()}s.gain>0&&l(s,"#4ade80"),c.gain<0&&l(c,"#f87171")}(r,0,c,l,i,s),E(a,o,t,R)}function T(t){const e=u(),n=document.createElement("div");n.className="flex justify-between items-center mb-2";const a=document.createElement("div");a.className="text-xs text-muted-foreground",a.textContent="Profit Chart";const o=p("Grids: "+(h()?"ON":"OFF"),()=>{var e;e=!h(),f=e,o.textContent="Grids: "+(h()?"ON":"OFF"),R(t)});n.appendChild(a),n.appendChild(o);const r=document.createElement("div");r.style.position="relative";const i=document.createElement("canvas");i.id="arcChart",i.style.width="100%",i.style.height="200px";const s=document.createElement("div");return s.id="arcTooltip",s.style.cssText="\n    position: absolute;\n    padding: 4px 6px;\n    background: #0009;\n    color: white;\n    font-size: 11px;\n    pointer-events: none;\n    border-radius: 4px;\n    display: none;\n  ",r.appendChild(i),r.appendChild(s),e.appendChild(n),e.appendChild(r),setTimeout(()=>R(t),0),e}function k(t){return"number"==typeof t.totalValueOverride?t.totalValueOverride:"number"==typeof t.effectiveValue?t.effectiveValue:0}function N(t,e){return Math.round(t/e)*e}function M(t){return t<2e4?500:t<8e4?1e3:t<2e5?2500:5e3}function A(t){if(0===t.length)return 0;return t.slice().sort((t,e)=>t-e)[Math.floor(t.length/2)]}function P(t){if(!t||0===t.length)return[];const e=t.map(k),n=e.filter(t=>t<0),a=e.filter(t=>t>0),o=e.length,r=(i=o,Math.max(4,Math.min(15,Math.ceil(Math.log2(i)+1))));var i;let s=Math.max(1,Math.round(n.length/o*(r-1))),c=Math.max(1,Math.round(a.length/o*(r-1)));const l=function(t,e,n,a){const o=t+e+n-a;return o>0?e>t?{binNeg:t,binPos:e-o}:{binNeg:t-o,binPos:e}:o<0?e>t?{binNeg:t,binPos:e+-o}:{binNeg:t+-o,binPos:e}:{binNeg:t,binPos:e}}(s,c,1,r);s=l.binNeg,c=l.binPos;const d=Math.min(...n,0),u=Math.max(...n,0),m=Math.min(...a,0),p=Math.max(...a,0),f=function(t,e,n,a,o,r){const i=[];if(t.length>0){const e=Math.min(...t),a=(Math.max(...t)-e)/n;for(let t=0;t<n;t++)i.push({min:N(e+t*a,o),max:N(e+(t+1)*a,o),values:[],type:"loss"})}if(i.push({min:0,max:0,values:[],type:"zero"}),e.length>0){const t=Math.min(...e),n=(Math.max(...e)-t)/a;for(let e=0;e<a;e++)i.push({min:N(t+e*n,r),max:N(t+(e+1)*n,r),values:[],type:"gain"})}return i}(n,a,s,c,M(Math.abs(d-u)),M(Math.abs(p-m)));return function(t,e){for(const n of t)for(const t of e){if("zero"===t.type&&0===n){t.values.push(n);break}if(n>=t.min&&n<t.max&&"zero"!==t.type){t.values.push(n);break}}}(e,f),function(t){return t.map(t=>({min:t.min,max:t.max,count:t.values.length,median:A(t.values),type:t.type}))}(f)}function B(t){const e=t._rawRaidList;if(!e||0===e.length)return;const a=document.getElementById("arcHistogram");if(!a)return;const o=a.getContext("2d");if(!o)return;const r=a.clientWidth,i=a.clientHeight;a.width=r,a.height=i;const s=P(e);if(!s||0===s.length)return;a._histBuckets=s,a._histBucketsRaw=e;const c=Math.max(...s.map(t=>t.count),1),l=r/s.length,d=Math.max(2,.18*l);o.clearRect(0,0,r,i),o.strokeStyle="rgba(255,255,255,0.2)",o.beginPath(),o.moveTo(0,i-1),o.lineTo(r,i-1),o.stroke(),s.forEach((t,e)=>{const a=e*l+d/2,r=t.count/c*(.75*i),s=i-r;let u;u="loss"===t.type?"rgba(248, 113, 113, 0.55)":"gain"===t.type?"rgba(74, 222, 128, 0.55)":"rgba(148, 163, 184, 0.45)",o.fillStyle=u,o.fillRect(a,s,l-d,r),o.fillStyle="#ccc",o.font="10px sans-serif",(l>55||e%2==0)&&o.fillText(`${n(t.min)} â†’ ${n(t.max)}`,a,i-4)})}function I(t){const e=document.getElementById("arcHistogram");if(!e)return;B(t);!function(t,e){const a=t._histBuckets;if(!a||0===a.length)return;const o=t.width,r=t.height,i=o/a.length;t.onmousemove=s=>{const c=t.getBoundingClientRect(),l=s.clientX-c.left,d=Math.floor(l/i);if(d<0||d>=a.length)return e.style.display="none",void B({_rawRaidList:t._histBucketsRaw});const u=a[d];let m;m="zero"===u.type?"0 â†’ 0":`${n(u.min)} â†’ ${n(u.max)}`;const p="loss"===(f=u.type)?"Loss":"gain"===f?"Gain":"Zero";var f;e.innerHTML=`\n                Range: ${m}<br>\n                Raids: ${u.count}<br>\n                Median: ${n(u.median)}<br>\n                Type: ${p}\n            `;let h=l+12;h+e.offsetWidth>o&&(h=l-e.offsetWidth-12),e.style.left=h+"px",e.style.top="16px",e.style.display="block",B({_rawRaidList:t._histBucketsRaw});const g=t.getContext("2d");g.save(),g.strokeStyle="rgba(255,255,255,0.35)",g.lineWidth=2,g.strokeRect(d*i+1,1,i-2,r-2),g.restore()},t.onmouseleave=()=>{e.style.display="none",B({_rawRaidList:t._histBucketsRaw})}}(e,document.getElementById("arcHistTooltip"))}function L(t){const e=u({span:1}),a=document.createElement("div");a.className="text-xs text-muted-foreground mb-3",a.textContent="Map Stats";const o=document.createElement("div");o.className="text-[11px] font-semibold text-muted-foreground mb-2",o.style.cssText="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 0.5rem;",o.innerHTML='\n    <div>MAP</div>\n    <div class="text-right">PROFIT</div>\n    <div class="text-right">SURVIVAL</div>\n    <div class="text-right">RAIDS</div>\n    <div class="text-right">SURVIVED</div>\n  ';const r=document.createElement("div");r.className="space-y-1";return t.mapStatsArray.slice().sort((t,e)=>e.profit!==t.profit?e.profit-t.profit:e.survivalRate!==t.survivalRate?e.survivalRate-t.survivalRate:e.raids-t.raids).forEach(t=>{r.appendChild(function(t){const e=document.createElement("div");e.className="items-center py-1 border-b border-muted/20",e.style.cssText="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 0.5rem;";const a=t.profit>=0?"text-green-500":"text-red-500";let o="text-red-500";t.survivalRate>.7?o="text-green-500":t.survivalRate>.5&&(o="text-yellow-400");const r=Math.round(100*t.survivalRate);return e.innerHTML=`\n    <div class="text-sm">${t.name}</div>\n    <div class="text-sm font-bold text-right ${a}">\n      ${t.profit>=0?"+":""}${n(t.profit)}\n    </div>\n    <div class="text-sm text-right font-semibold ${o}">\n      ${r}%\n    </div>\n    <div class="text-sm text-right">${t.raids}</div>\n    <div class="text-sm text-right">${t.survived}</div>\n  `,e}(t))}),e.appendChild(a),e.appendChild(o),e.appendChild(r),e}let $=null;function D(t){const e=document.querySelectorAll("div[data-slot='card-content']")[0]||null;if(!e)return;$||($=document.createElement("div"),$.id="arcStatsBlock",$.className="space-y-3 mb-4",e.insertBefore($,e.children[1])),$.innerHTML="";const n=m("arc-row-4cols");n.appendChild(g(t)),n.appendChild(function(t){const e=u({span:1}),n=document.createElement("div");n.className="text-xs text-muted-foreground mb-1",n.textContent="Raid Summary";const a=b("Total:",t.totalRaids),o=b("Survived:",t.totalSurvived,"text-green-500"),r=b("KIA:",t.totalKIA,"text-red-500"),i=y(t);return e.appendChild(n),e.appendChild(a),e.appendChild(o),e.appendChild(r),e.appendChild(i),e}(t)),$.appendChild(n),$.appendChild(T(t));const a=m("arc-row-2cols");a.appendChild(function(t){const e=u({span:1}),n=document.createElement("div");n.className="flex justify-between items-center mb-2";const a=document.createElement("div");a.className="text-xs text-muted-foreground",a.textContent="Profit Distribution",n.appendChild(a);const o=document.createElement("div");o.style.position="relative";const r=document.createElement("canvas");r.id="arcHistogram",r.style.width="100%",r.style.height="180px";const i=document.createElement("div");return i.id="arcHistTooltip",i.style.cssText="\n    position: absolute;\n    padding: 4px 6px;\n    background: #0009;\n    color: white;\n    font-size: 11px;\n    pointer-events: none;\n    border-radius: 4px;\n    display: none;\n  ",o.appendChild(r),o.appendChild(i),e.appendChild(n),e.appendChild(o),setTimeout(()=>I(t),0),e}(t)),a.appendChild(L(t)),$.appendChild(a)}let O=null;function _(t){null!==O&&clearTimeout(O),O=setTimeout(async()=>{console.log("[ArcStats] Filters changed, refreshing...");const e=await c(t),n=d(e);n._rawRaidList=e,D(n),I(n)},300)}!function(){console.log("[ArcStats] Initializing..."),function(){if(document.getElementById("arcStatsCustomStyles"))return;const t=document.createElement("style");t.id="arcStatsCustomStyles",t.textContent="\n    /* =============================================================================\n       ARC STATS CUSTOM GRID SYSTEM\n       Overrides ArcTracker's forced grid-column rules with !important\n       ============================================================================= */\n\n    /* Base container styling */\n    #arcStatsBlock {\n      width: 100% !important;\n      max-width: 100% !important;\n    }\n\n    /* 4-column grid (for 75%/25% or other layouts) */\n    #arcStatsBlock .arc-row-4cols {\n      display: grid !important;\n      grid-template-columns: repeat(4, 1fr) !important;\n      gap: 0.75rem !important;\n      width: 100% !important;\n    }\n\n    /* 2-column grid (for 50%/50% layouts) */\n    #arcStatsBlock .arc-row-2cols {\n      display: grid !important;\n      grid-template-columns: repeat(2, 1fr) !important;\n      gap: 0.75rem !important;\n      width: 100% !important;\n    }\n\n    /* Single column (full-width) */\n    #arcStatsBlock .arc-row-1col {\n      display: block !important;\n      width: 100% !important;\n    }\n\n    /* Column span classes */\n    #arcStatsBlock .arc-span-4 {\n      grid-column: span 4 / span 4 !important;\n    }\n\n    #arcStatsBlock .arc-span-3 {\n      grid-column: span 3 / span 3 !important;\n    }\n\n    #arcStatsBlock .arc-span-2 {\n      grid-column: span 2 / span 2 !important;\n    }\n\n    #arcStatsBlock .arc-span-1 {\n      grid-column: span 1 / span 1 !important;\n    }\n\n    /* Responsive behavior for tablets */\n    @media (max-width: 768px) {\n      #arcStatsBlock .arc-row-4cols {\n        grid-template-columns: repeat(2, 1fr) !important;\n      }\n\n      #arcStatsBlock .arc-span-3 {\n        grid-column: span 2 / span 2 !important;\n      }\n    }\n\n    /* Responsive behavior for mobile */\n    @media (max-width: 640px) {\n      #arcStatsBlock .arc-row-4cols,\n      #arcStatsBlock .arc-row-2cols {\n        grid-template-columns: 1fr !important;\n      }\n\n      #arcStatsBlock .arc-span-4,\n      #arcStatsBlock .arc-span-3,\n      #arcStatsBlock .arc-span-2,\n      #arcStatsBlock .arc-span-1 {\n        grid-column: span 1 / span 1 !important;\n      }\n    }\n  ",document.head.appendChild(t),console.log("[ArcStats] Custom grid styles injected")}(),function(){const n=globalThis.fetch;globalThis.fetch=async function(a,o){try{"string"!=typeof a||!a.includes("/api/raids?")||o?.headers&&"X-ArcStats"in o.headers||(t=a,console.log("[ArcStats] Detected API:",a),e&&e(a))}catch(t){console.error("[ArcStats] API watch error:",t)}return n(a,o)}}(),e=_;t&&_(t),console.log("[ArcStats] Ready!")}()}();
